/*
 * Leaflet Location Picker v0.3.2 - 2020-04-28
 *
 * Copyright 2020 Stefano Cudini
 * stefano.cudini@gmail.com
 * http://labs.easyblog.it/
 *
 * Licensed under the MIT license.
 *
 * Demo:
 * http://labs.easyblog.it/maps/leaflet-locationpicker/
 *
 * Source:
 * git@github.com:stefanocudini/leaflet-locationpicker.git
 *
 */
!function(t){if("function"==typeof define&&define.amd)define(["jquery","leaflet"],t);else if("undefined"!=typeof module)module.exports=t(require("jquery","leaflet"));else{if(void 0===window.jQuery)throw"jQuery must be loaded first";if(void 0===window.L)throw"Leaflet must be loaded first";t(window.jQuery,window.L)}}(function(t,e){var a=t;a.fn.leafletLocationPicker=function(t,o){var n={OSM:window.location.protocol+"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"},i={zoom:0,center:e.latLng([40,0]),zoomControl:!1,attributionControl:!1};a.isPlainObject(t)&&a.isPlainObject(t.map)&&(i=a.extend(i,t.map));var l={alwaysOpen:!1,className:"leaflet-locpicker",location:i.center,locationFormat:"{lat}{sep}{lng}",locationMarker:!0,locationDigits:6,locationSep:",",position:"topright",layer:"OSM",height:140,width:200,event:"click",cursorSize:"30px",readOnly:!1,map:i,onChangeLocation:a.noop,mapContainer:""};function r(o){var n=o;switch(a.type(o)){case"string":var i=o.split(t.locationSep);n=i[0]&&i[1]?e.latLng(i):null;break;case"array":n=e.latLng(o);break;case"object":var l,r;o.hasOwnProperty("lat")?l=o.lat:o.hasOwnProperty("latitude")&&(l=o.latitude),o.hasOwnProperty("lng")?r=o.lng:o.hasOwnProperty("lon")?r=o.lon:o.hasOwnProperty("longitude")&&(r=o.longitude),n=e.latLng(parseFloat(l),parseFloat(r));break;default:n=o}return function(a){return a?e.latLng(parseFloat(a.lat).toFixed(t.locationDigits),parseFloat(a.lng).toFixed(t.locationDigits)):a}(n)}function c(o){if(o.divMap=document.createElement("div"),o.$map=a(document.createElement("div")).addClass(t.className+"-map").height(t.height).width(t.width).append(o.divMap),t.readOnly&&o.$map.addClass("read-only"),t.mapContainer&&a(t.mapContainer)?o.$map.appendTo(t.mapContainer).addClass("map-select"):o.$map.appendTo("body"),o.location&&(t.map.center=o.location),"string"==typeof t.layer&&n[t.layer]?t.map.layers=e.tileLayer(n[t.layer]):t.layer instanceof e.TileLayer||t.layer instanceof e.GridLayer||t.layer instanceof e.LayerGroup?t.map.layers=t.layer:t.map.layers=e.tileLayer(n.OSM),o.map=e.map(o.divMap,t.map).addControl(e.control.zoom({position:"bottomright"})).on(t.event,function(e){t.readOnly||o.setLocation(e.latlng)}),t.activeOnMove&&o.map.on("move",function(t){o.setLocation(t.target.getCenter())}),!0!==t.alwaysOpen){var i=e.control({position:"topright"});i.onAdd=function(a){var n=e.DomUtil.create("div","leaflet-bar"),i=e.DomUtil.create("a","leaflet-control "+t.className+"-close");return i.innerHTML="&times;",n.appendChild(i),e.DomEvent.on(i,"click",e.DomEvent.stop,o).on(i,"click",o.closeMap,o),n},i.addTo(o.map)}var l;return t.locationMarker&&(o.marker=(l=o.location,e.marker(r(l)||e.latLng(0,0),{icon:e.divIcon({className:t.className+"-marker",iconAnchor:e.point(0,0),html:"<div"+("30px"!==t.cursorSize?'style="width: '+t.cursorSize+"; height: "+t.cursorSize+';"':"")+'><div class="corner1"></div><div class="corner2"></div><div class="corner3"></div><div class="corner4"></div></div>'})})).addTo(o.map)),o.$map}return t=a.isPlainObject(t)?a.extend(l,t):a.isFunction(t)?a.extend(l,{onChangeLocation:t}):l,a.isFunction(o)&&(t=a.extend(l,{onChangeLocation:o})),a(this).each(function(o,n){var i=this;i.$input=a(this),i.options=t,i.setReadOnly=function(e){t.readOnly=e,i.$map.toggleClass("read-only",e)},i.locationOri=i.$input.val(),i.onChangeLocation=function(){var e={latlng:i.location,location:i.getLocation()};i.$input.trigger(a.extend(e,{type:"changeLocation"})),t.onChangeLocation.call(i,e)},i.setLocation=function(t,e){t=t||l.location,i.location=r(t),i.marker&&i.marker.setLatLng(t),e||(i.$input.data("location",i.location),i.$input.val(i.getLocation()),i.onChangeLocation())},i.getLocation=function(){return i.location?e.Util.template(t.locationFormat,{lat:i.location.lat,lng:i.location.lng,sep:t.locationSep}):i.location},i.updatePosition=function(){switch(t.position){case"bottomleft":i.$map.css({top:i.$input.offset().top+i.$input.height()+6,left:i.$input.offset().left});break;case"topright":i.$map.css({top:i.$input.offset().top,left:i.$input.offset().left+i.$input.width()+5})}},i.openMap=function(){i.updatePosition(),i.$map.show(),i.map.invalidateSize(),i.$input.trigger("show")},i.closeMap=function(){i.$map.hide(),i.$input.trigger("hide")},i.setLocation(i.locationOri,!0),i.$map=c(i),i.$input.addClass(t.className).on("focus."+t.className,function(t){t.preventDefault(),i.openMap()}).on("blur."+t.className,function(t){t.preventDefault();for(var e=t.relatedTarget,a=!0;e;){if(e._leaflet){a=!1;break}e=e.parentElement}a&&setTimeout(function(){i.closeMap()},100)}),a(window).on("resize",function(){i.$map.is(":visible")&&i.updatePosition()}),t.alwaysOpen&&!0===t.alwaysOpen&&i.openMap()}),this}});